<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>

        button {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .btn-toggle {
            background-color: #247fe0ff;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            text-decoration: none;
            display: inline-block;
        }

        .btn-delete {
            background-color: #db2d41ff;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            text-decoration: none;
            display: inline-block;
        }

        .btn-edit {
            background-color: #1c973bff;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            text-decoration: none;
            display: inline-block;
        }

        .btn-sort {
        background-color: #464646ff;
        color: white;
        padding: 5px 10px;
        border-radius: 4px;
        text-decoration: none;
        display: inline-block;
        margin-right: 5px;
        font-size: 0.9em;
        }

        .btn-stats {
        background-color: #6f5b79ff;
        color: white;
        padding: 5px 10px;
        border-radius: 4px;
        text-decoration: none;
        display: inline-block;
        margin-right: 5px;
        font-size: 0.9em;
        }

        .btn-sort.active {
        background-color: #247fe0ff;
        color: white;
        }
        
        .btn-sort:hover {
        background-color: #252525ff;
        }

        .book-read {
            color: green;
        }

        .book-unread {
            color: red;
        }

        .book-grid {
            display: grid;
            grid-template-columns: 200px 150px 80px 80px 120px 80px 80px 60px 120px 120px 120px 200px;
            gap: 10px;
            align-items: center;
            padding: 4px 8px;
            border-bottom: 1px solid #ccc;
        }

        .book-item {
            display: flex;
            justify-content: space-between;
            grid-template-columns: 200px 150px 80px 80px 120px 80px 80px 60px 120px 120px 120px 200px;
            align-items: center;
        }

        .book-actions form, .book-actions a {
            margin-left: 5px;
        }

        .book-grid.header {
            font-weight: bold;
            background-color: #f0f0f0;
            padding: 6px 8px;
            border-bottom: 2px solid #ccc;
            display: grid;
            grid-template-columns: 30px 200px 150px 80px 80px 120px 80px 60px 78px 120px 120px 359px 200px;
            gap: 10px;
            align-items: center;
        }

        .book-actions {
            display: flex;
            justify-content: flex-end;
            gap: 5px;
            align-items: center;
        }

        h2 {
            margin-top: 20px;
            margin-bottom: 10px;
        }

    </style>
</head>
<body>
    <h1>Registo de Livros</h1>

    <form action="{% url 'book_list' %}" method="post">
        {% csrf_token %}
        <input type="text" name="title" placeholder="Título" required>
        <input type="text" name="author" placeholder="Autor" required>
        <input type="number" name="ano_publicacao" placeholder="Ano de Publicação" required>
        <input type="number" name="paginas" placeholder="Número de Páginas" required>
        <input type="text" name="tema_principal" placeholder="Tema Principal" required>
        <input type="number" step="0.01" name="preco" placeholder="Preço">
        <input type="text" name="edicao" placeholder="Edição">
        <select name="avaliacao_pessoal" id="avaliacao_pessoal">
            <option value="">Avaliação</option>
            {% for i in "12345" %}
                <option value="{{ i }}">{{ i }}</option>
            {% endfor %}
        </select>
        <label for="date_start">Data do Início da Leitura:</label>
        <input type="date" name="date_start" placeholder="Início da leitura">
        <button type="submit">Adicionar</button>
    </form>
    <h2>Pesquisar / Filtrar</h2>
    <form method="get" style="margin-bottom: 20px;">
        <input type="text" name="search" placeholder="Pesquisar por título" value="{{ search }}">
        
        <select name="filter_read">
            <option value="" {% if filter_read == "" %}selected{% endif %}>Todos</option>
            <option value="read" {% if filter_read == "read" %}selected{% endif %}>Lidos</option>
            <option value="unread" {% if filter_read == "unread" %}selected{% endif %}>Não Lidos</option>
        </select>

        <input type="hidden" name="sort" value="{{ current_sort }}">
        <input type="hidden" name="direction" value="{{ current_direction }}">

        <button type="submit">Filtrar</button>
    </form>
    <div class="sort-links" style="margin-bottom: 20px;">
        <a href="?sort=title&direction=asc&search={{ search|urlencode }}&filter_read={{ filter_read }}"
            class="btn-sort {% if current_sort == 'title' and current_direction == 'asc' %}active{% endif %}">
            Título ↑
        </a>
        <a href="?sort=title&direction=desc&search={{ search|urlencode }}&filter_read={{ filter_read }}"
            class="btn-sort {% if current_sort == 'title' and current_direction == 'desc' %}active{% endif %}">
            Título ↓
        </a>

        <a href="?sort=date_start&direction=asc&search={{ search|urlencode }}&filter_read={{ filter_read }}"
            class="btn-sort {% if current_sort == 'date_start' and current_direction == 'asc' %}active{% endif %}">
            Início Leitura ↑
        </a>
        <a href="?sort=date_start&direction=desc&search={{ search|urlencode }}&filter_read={{ filter_read }}"
            class="btn-sort {% if current_sort == 'date_start' and current_direction == 'desc' %}active{% endif %}">
            Início Leitura ↓
        </a>
        <a href="/" class="btn-sort" style="background-color:#db2d41ff;">Limpar Sort</a>
        <a href="{% url 'stats' %}" class="btn-stats">Estatísticas</a>


</div>

    <h2 style="margin-top: 20px; margin-bottom: 10px;">Lista de Livros</h2>

    <div class="book-grid header">
        <span></span>
        <span>Título</span>
        <span>Autor</span>
        <span>Ano</span>
        <span>Páginas</span>
        <span>Tema</span>
        <span>Preço</span>
        <span>Edição</span>
        <span>Avaliação</span>
        <span>Registado a</span>
        <span>Início Leitura</span>
        <span>Lido a</span>
        <span>Ações</span> 
    </div>
        <ul>
            {% for book in books %}
            <li class="book-item {% if book.read %}book-read{% else %}book-unread{% endif %}">
                <div class="book-grid">
                    <span class="book-title">{{ book.title }}</span>
                    <span class="book-author">{{ book.author }}</span>
                    <span class="book-year">{{ book.ano_publicacao }}</span>
                    <span class="book-pages">{{ book.paginas }}</span>
                    <span class="book-theme">{{ book.tema_principal }}</span>
                    <span class="book-preco">{% if book.preco %}{{ book.preco }}€{% endif %}</span>
                    <span class="book-edicao">{% if book.edicao %}{{ book.edicao }}{% endif %}</span>
                    <span class="book-avaliacao">{% if book.avaliacao_pessoal %}{{ book.avaliacao_pessoal }}/5{% endif %}</span>
                    <span class="book-registered">{{ book.date_reg|date:"d/m/Y" }}</span>
                    <span class="book-start">{% if book.date_start %}{{ book.date_start|date:"d/m/Y" }}{% endif %}</span>
                    <span class="book-read-date">{% if book.date_read %}{{ book.date_read|date:"d/m/Y" }}{% endif %}</span>
                </div>
                <div class="book-actions">
                    <form action="{% url 'toggle_book' book.id %}" method="post" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn-toggle">{% if book.read %}Marcar como Não Lido{% else %}Marcar como Lido{% endif %}</button>
                    </form>
                    <a href="{% url 'edit_book' book.id %}" class="btn-edit">Editar</a>
                    <form action="{% url 'delete_book' book.id %}" method="post" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" onclick="return confirm('Pretende eliminar este livro?')" class="btn-delete">Eliminar</button>
                    </form>
                </div>
            </li>
            {% empty %}
                <li>Nenhum livro adicionado ainda.</li>
            {% endfor %}
        </ul>
    
</body>
</html>