<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- CSS Block -->
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f6fbffff;
        }

        button {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .btn-toggle {
            background-color: #247fe0ff;
            color: white;
            padding: 6px 14px;
            border-radius: 4px;
            text-decoration: none;
            white-space: nowrap;
            line-height: 1.2;
            display: inline-block;
        }

        .btn-delete {
            background-color: #db2d41ff;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            text-decoration: none;
            display: inline-block;
        }

        .btn-edit {
            background-color: #1c973bff;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            text-decoration: none;
            display: inline-block;
        }

        .btn-excel {
            background-color: #28a745;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            text-decoration: none;
            display: inline-block;
            margin-right: 5px;
            font-size: 0.9em;
        }

        .btn-stats {
            background-color: #6f5b79ff;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            text-decoration: none;
            display: inline-block;
            margin-right: 5px;
            font-size: 0.9em;
        }

        .book-read {
            color: green;
        }

        .book-unread {
            color: red;
        }

        .book-grid {
            display: grid;
            grid-template-columns: 300px 200px 80px 80px 120px 80px 80px 60px 120px 120px 120px 0px;
            gap: 10px;
            align-items: center;
            padding: 2px 8px;
            border-bottom: 1px solid #ccc;
        }

        .book-item {
            display: flex;
            justify-content: space-between;
            grid-template-columns: 200px 150px 80px 80px 120px 80px 80px 60px 120px 120px 120px 200px;
            align-items: center;
        }

        .book-actions button,
        .book-actions a {
            padding: 2px 6px;
            font-size: 0.9em;
            line-height: 1.2;
        }

        .book-grid.header {
            font-weight: bold;
            background-color: #f0f0f0;
            padding: 6px 8px;
            border-bottom: 2px solid #ccc;
            display: grid;
            grid-template-columns: 30px 300px 200px 80px 80px 120px 80px 60px 78px 120px 120px 230px 0px;
            gap: 10px;
            align-items: center;
        }

        .book-actions {
            display: flex;
            gap: 6px;
            justify-content: flex-end;
            align-items: center;
        }

        h2 {
            margin-top: 100px;
            margin-bottom: 10px;
            font-size: 1em;
        }

        h3 {
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1em;
        }

        h4 {
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.5em;
            text-align: center;
        }

    </style>
</head>
<!-- HTML Block -->
<body>
    <!-- Registo -->
    <h1>Registo de Livros</h1>

    <form action="{% url 'book_list' %}" method="post">
        {% csrf_token %}
        <input type="text" name="title" placeholder="Título" required>
        <input type="text" name="author" placeholder="Autor" required>
        <input type="number" name="ano_publicacao" placeholder="Ano de Publicação" required>
        <input type="number" name="paginas" placeholder="Número de Páginas" required>
        <input type="text" name="tema_principal" placeholder="Tema Principal" required>
        <input type="number" step="0.01" name="preco" placeholder="Preço">
        <input type="text" name="edicao" placeholder="Edição">
        <select name="avaliacao_pessoal" id="avaliacao_pessoal">
            <option value="">Avaliação</option>
            {% for i in "12345" %}
                <option value="{{ i }}">{{ i }}</option>
            {% endfor %}
        </select>
        <label for="date_start">Data do Início da Leitura:</label>
        <input type="date" name="date_start" placeholder="Início da leitura">
        <button type="submit">Adicionar</button>
    </form>
    <!-- Pesquisa -->
    <h2>Pesquisar</h2>
    <form method="get" style="margin-bottom: 20px;">
        <input type="text" name="search" placeholder="Pesquisar por título/autor" value="{{ search }}">
        
        <select name="filter_read">
            <option value="" {% if filter_read == "" %}selected{% endif %}>Todos</option>
            <option value="read" {% if filter_read == "read" %}selected{% endif %}>Lidos</option>
            <option value="unread" {% if filter_read == "unread" %}selected{% endif %}>Não Lidos</option>
        </select>

        <input type="hidden" name="sort" value="{{ current_sort }}">
        <input type="hidden" name="direction" value="{{ current_direction }}">

        <button type="submit">Filtrar</button>
    </form>
    <!-- Ordenação -->
    <h3>Ordenar</h3>
    <form method="get" class="sort-form">
        <select name="sort" id="sort">
            <option value="title" {% if current_sort == "title" %}selected{% endif %}>Título</option>
            <option value="author" {% if current_sort == "author" %}selected{% endif %}>Autor</option>
            <option value="ano_publicacao" {% if current_sort == "ano_publicacao" %}selected{% endif %}>Ano</option>
            <option value="paginas" {% if current_sort == "paginas" %}selected{% endif %}>Páginas</option>
            <option value="tema_principal" {% if current_sort == "tema_principal" %}selected{% endif %}>Tema</option>
            <option value="preco" {% if current_sort == "preco" %}selected{% endif %}>Preço</option>
            <option value="edicao" {% if current_sort == "edicao" %}selected{% endif %}>Edição</option>
            <option value="avaliacao_pessoal" {% if current_sort == "avaliacao_pessoal" %}selected{% endif %}>Avaliação</option>
            <option value="date_reg" {% if current_sort == "date_reg" %}selected{% endif %}>Data de registo</option>
            <option value="date_start" {% if current_sort == "date_start" %}selected{% endif %}>Início da leitura</option>
            <option value="date_read" {% if current_sort == "date_read" %}selected{% endif %}>Fim da leitura</option>
        </select>

        <select name="direction" id="direction">
            <option value="asc" {% if current_direction == "asc" %}selected{% endif %}>Ascendente</option>
            <option value="desc" {% if current_direction == "desc" %}selected{% endif %}>Descendente</option>
        </select>

        <button type="submit">Ordenar</button>
        <a href="/" class="btn-excel" style="background-color:#db2d41ff;">Limpar Sort</a>
    </form>
    <!-- Header -->
    <h4>Lista de Livros Registados</h4>
    <div class="book-grid header">
        <span></span>
        <span>Título</span>
        <span>Autor</span>
        <span>Ano</span>
        <span>Páginas</span>
        <span>Tema</span>
        <span>Preço</span>
        <span>Edição</span>
        <span>Avaliação</span>
        <span>Registado a</span>
        <span>Início Leitura</span>
        <span>Lido a</span>
        <span>Ações</span> 
    </div>
        <ul>
            <!-- Lista -->
            {% for book in books %}
            <li class="book-item {% if book.read %}book-read{% else %}book-unread{% endif %}">
                <div class="book-grid">
                    <span class="book-title">{{ book.title }}</span>
                    <span class="book-author">{{ book.author }}</span>
                    <span class="book-year">{{ book.ano_publicacao }}</span>
                    <span class="book-pages">{{ book.paginas }}</span>
                    <span class="book-theme">{{ book.tema_principal }}</span>
                    <span class="book-preco">{% if book.preco %}{{ book.preco }}€{% endif %}</span>
                    <span class="book-edicao">{% if book.edicao %}{{ book.edicao }}{% endif %}</span>
                    <span class="book-avaliacao">{% if book.avaliacao_pessoal %}{{ book.avaliacao_pessoal }}/5{% endif %}</span>
                    <span class="book-registered">{{ book.date_reg|date:"d/m/Y" }}</span>
                    <span class="book-start">{% if book.date_start %}{{ book.date_start|date:"d/m/Y" }}{% endif %}</span>
                    <span class="book-read-date">{% if book.date_read %}{{ book.date_read|date:"d/m/Y" }}{% endif %}</span>
                </div>
                <!-- Acções possíveis com os livros -->
                <div class="book-actions">
                    <form action="{% url 'toggle_book' book.id %}" method="post" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn-toggle">{% if book.read %}Marcar como Não Lido{% else %}Marcar como Lido{% endif %}</button>
                    </form>
                    <a href="{% url 'edit_book' book.id %}" class="btn-edit">Editar</a>
                    <form action="{% url 'delete_book' book.id %}" method="post" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" onclick="return confirm('Pretende eliminar este livro?')" class="btn-delete">Eliminar</button>
                    </form>
                </div>
            </li>
        {% empty %}
            <li>Nenhum livro adicionado ainda.</li>
        {% endfor %}
        </ul>
        <!-- Exportar, Estatistica, Logout -->
        <div style="margin-top: 20px; text-align: right;">
            <a href="{% url 'stats' %}" class="btn-stats">Estatísticas</a>
            <a href="{% url 'export_books_excel' %}" class="btn-excel">Exportar para Excel</a>
        </div>
        <form method="post" action="{% url 'logout' %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit" class="btn-delete">Logout</button>
        </form>

</body>
</html>